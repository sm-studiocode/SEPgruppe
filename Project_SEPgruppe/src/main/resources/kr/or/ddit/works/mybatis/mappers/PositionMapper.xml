<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.works.mybatis.mappers.PositionMapper">

    <!-- 관리자 - 직위 목록 -->
    <select id="selectPositionList" resultType="PositionVO">
        SELECT position_cd, position_name
        FROM position
        ORDER BY position_cd
    </select>

    <!-- 직위명 단건 -->
    <select id="selectPositionName" resultType="String">
        SELECT position_name
        FROM position
        WHERE position_cd = #{positionCd}
    </select>

    <!-- 관리자 - 직위 삭제 -->
    <delete id="deletePositions">
        DELETE FROM position
        WHERE position_cd IN
        <foreach item="code" collection="positionCds" open="(" separator="," close=")">
            #{code}
        </foreach>
    </delete>

    <!-- 직위별 인원수 포함 목록 -->
    <select id="selectPositionListCount" resultType="PositionVO">
        SELECT p.position_cd,
               p.position_name,
               (SELECT COUNT(*) FROM employee e WHERE e.position_cd = p.position_cd) AS member_count
        FROM position p
        ORDER BY p.position_cd
    </select>

    <!-- 관리자 - 직위 등록 -->
    <insert id="insertPosition">
        INSERT INTO position (position_cd, position_name)
        VALUES (#{positionCd}, #{positionName})
    </insert>

    <!-- 관리자 - 정렬 순서 변경 -->
    <update id="updateSortOrder">
        UPDATE position
        SET sort_order = #{sortOrder}
        WHERE position_cd = #{positionCd}
    </update>

</mapper>
